{% extends "todo/base.html" %}
{% load static %}

{% block title %}Trellado{% endblock %}
{% block page_title %}Trellado{% endblock %}

{% block header_buttons %}
{% if user.is_authenticated %}
<form action="/create_card" method="GET" style="padding-bottom: 20px;">
    <button value="create" type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-plus"></span> &nbsp; Create Card
    </button>
</form>
{% endif %}
{% endblock %}

{% block content %}
<!-- COLUNAS -->
<div class="container">
    {% for chave_column, dados_column in columns.items %}
    <div class="column" data-column="{{ chave_column }}">
        <h3>{{ dados_column.name }}</h3>
        <div class="cards-container">
            {% for card in dados_column.cards %}
            <div class="card" draggable="true" data-card-id="{{ card.id }}">
                <div class="card-title">{{ card.title }}</div>
                <hr>
                
                <div class="due-date-info">
                    <div>üìÖ Created: {{ card.created_in|date:"d/m/Y" }}</div>
                    {% if card.due_date %}
                    <div>‚è∞ Due Date: {{ card.due_date|date:"d/m/Y" }}</div>
                    <div>Status: 
                        {% if card.due_date < today %}
                            <span style="color:red">‚ö†Ô∏è Late</span>
                        {% else %}
                            <span style="color:green">‚úÖ On Time</span>
                        {% endif %}
                    </div>
                    {% else %}
                    <div>‚è∞ Due Date: <span style="color: #999;">No due date</span></div>
                    {% endif %}
                </div>
                
                <hr>
                <div class="card-details">{{ card.details|truncatewords:15 }}</div>

                <div class="card-buttons">
                    <form action="{% url 'edit_card' card.id %}" method="GET">
                        <button type="submit" class="btn btn-primary btn-sm">
                            <span class="glyphicon glyphicon-edit"></span> Edit
                        </button>
                    </form>

                    <form action="{% url 'del' card.id %}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">
                            <span class="glyphicon glyphicon-trash"></span> Delete
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script src="../../static/script.js"></script>
{% endblock %}